<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <!-- Head -->
  <th:block th:replace="fragments/head :: head(${title})"></th:block>
  <style>
    /* Dashboard Stats Cards */
    .stats-card {
      background: white;
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border-left: 4px solid;
      height: 100%;
    }
    
    .stats-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }
    
    .stats-card.blood-donated {
      border-left-color: #c62828;
      background: linear-gradient(135deg, rgba(198, 40, 40, 0.05) 0%, white 100%);
    }
    
    .stats-card.blood-requests {
      border-left-color: #e91e63;
      background: linear-gradient(135deg, rgba(233, 30, 99, 0.05) 0%, white 100%);
    }
    
    .stats-card.pending-donors {
      border-left-color: #ffc107;
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.05) 0%, white 100%);
    }
    
    .stats-card.total-appointments {
      border-left-color: #4895ef;
      background: linear-gradient(135deg, rgba(72, 149, 239, 0.05) 0%, white 100%);
    }
    
    .stats-icon {
      font-size: 3rem;
      opacity: 0.3;
      position: absolute;
      right: 1.5rem;
      top: 50%;
      transform: translateY(-50%);
    }
    
    .stats-card.blood-donated .stats-icon { color: #c62828; }
    .stats-card.blood-requests .stats-icon { color: #e91e63; }
    .stats-card.pending-donors .stats-icon { color: #ffc107; }
    .stats-card.total-appointments .stats-icon { color: #4895ef; }
    
    .stats-value {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0;
    }
    
    .stats-label {
      font-size: 0.95rem;
      color: #6c757d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }
    
    .stats-change {
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }
    
    .stats-change.positive {
      color: #198754;
    }
    
    .stats-change.urgent {
      color: #e91e63;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div th:replace="fragments/sidebar :: sidebar(${active})"></div>

  <!-- Main Content -->
  <div id="content">
    <!-- Top nav -->
    <div th:replace="~{fragments/topnav :: topnav(${userName}, ${avatarUrl})}"></div>

    <!-- Page content -->
    <main class="container-fluid p-4">
      <!-- Header -->
      <div class="mb-4">
        <h2 class="mb-0 fw-bold" style="color: var(--primary-color);">
          <i class="bi bi-speedometer2 me-2" style="color: #c62828;"></i>Dashboard
        </h2>
        <p class="text-muted mb-0">Blood Bank Management Overview</p>
      </div>

      <!-- Statistics Cards -->
      <div class="row g-4">
        <!-- Total Blood Donated -->
        <div class="col-lg-3 col-md-6">
          <div class="stats-card blood-donated position-relative">
            <i class="bi bi-droplet-fill stats-icon"></i>
            <div class="stats-content">
              <p class="stats-label mb-2">Total Blood Donated</p>
              <h3 class="stats-value" th:text="${totalBloodDonated != null ? totalBloodDonated : 0}">0</h3>
              <p class="stats-change positive mb-0">
                <i class="bi bi-arrow-up-circle-fill me-1"></i>
                <span>Units</span>
              </p>
            </div>
          </div>
        </div>

        <!-- Pending Blood Requests -->
        <div class="col-lg-3 col-md-6">
          <div class="stats-card blood-requests position-relative">
            <i class="bi bi-clipboard-heart stats-icon"></i>
            <div class="stats-content">
              <p class="stats-label mb-2">Pending Blood Request</p>
              <h3 class="stats-value" th:text="${pendingBloodRequests != null ? pendingBloodRequests : 0}">0</h3>
              <p class="stats-change urgent mb-0">
                <i class="bi bi-exclamation-triangle-fill me-1"></i>
                <span>Requests</span>
              </p>
            </div>
          </div>
        </div>

        <!-- Pending Donors -->
        <div class="col-lg-3 col-md-6">
          <div class="stats-card pending-donors position-relative">
            <i class="bi bi-hourglass-split stats-icon"></i>
            <div class="stats-content">
              <p class="stats-label mb-2">Pending Donors</p>
              <h3 class="stats-value" th:text="${pendingDonors != null ? pendingDonors : 0}">0</h3>
              <p class="stats-change mb-0" style="color: #ffc107;">
                <i class="bi bi-clock-fill me-1"></i>
                <span>Awaiting</span>
              </p>
            </div>
          </div>
        </div>

        <!-- Total Appointments -->
        <div class="col-lg-3 col-md-6">
          <div class="stats-card total-appointments position-relative">
            <i class="bi bi-calendar-check stats-icon"></i>
            <div class="stats-content">
              <p class="stats-label mb-2">Total Appointments</p>
              <h3 class="stats-value" th:text="${totalAppointments != null ? totalAppointments : 0}">0</h3>
              <p class="stats-change mb-0" style="color: #4895ef;">
                <i class="bi bi-calendar2-event me-1"></i>
                <span>Scheduled</span>
              </p>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- JS loaded directly -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script th:src="@{/js/dashboard.js}"></script>

  <script>
    // Animate number counting
    document.addEventListener('DOMContentLoaded', function() {
      const animateValue = (element, start, end, duration) => {
        let startTimestamp = null;
        const step = (timestamp) => {
          if (!startTimestamp) startTimestamp = timestamp;
          const progress = Math.min((timestamp - startTimestamp) / duration, 1);
          element.textContent = Math.floor(progress * (end - start) + start);
          if (progress < 1) {
            window.requestAnimationFrame(step);
          }
        };
        window.requestAnimationFrame(step);
      };

      // Animate all stats values
      document.querySelectorAll('.stats-value').forEach(el => {
        const finalValue = parseInt(el.textContent) || 0;
        animateValue(el, 0, finalValue, 1500);
      });
    });
  </script>
</body>
</html>
